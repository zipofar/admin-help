====== Уведомления в Telegram при успешном входе по SSH (Ubuntu 16.04) ======

Параноидальная часть меня хочет больше контроля над тем, что происходит с сервером. Поэтому я решил сделать, чтобы при удачной попытке входа на сервер по SSH мне в Telegram приходили уведомления.

Для этого я воспользовался следующими штуками:
  * PAM для запуска bash скрипта, отправляющего уведомление при удачной попытке входа по ssh;
  * Сторонним [[http://crierbot.appspot.com|Telegram ботом]] (crierbot) для получения уведомлений;

===== Настроим PAM =====

<code>
#/etc/pam.d/sshd
# Добавляем в конец строку

session   optional      pam_exec.so /etc/pam.d/sshd_telegram_notify.sh
</code>

session — т.к. наша строка находится в конце, а правила в pam работают по цепочке. Это означает, что отправка уведомления сработает уже после того как пользователь успешно залогинился. Директива Session охватывает группу задач, выполняющихся до предоставления сервисов, доступных пользователю и после завершения.

optional — директива, которая говорит о том, что результат выполнения нашего скрипта никак не повлияет на вход пользователя.

pam_exec.so — модуль обеспечивающий запуск скрипта.

/etc/pam.d/sshd_telegram_notify.sh — абсолютный путь до нашего скрипта. Не забываем сделать файл исполняемым chmod +x /etc/pam.d/sshd_telegram_notify.sh

===== BASH скрипт =====

<code>
#!/bin/bash

HOSTN=`hostname`

curl "http://crierbot.appspot.com/vxCEgUbcYBd5lnR9oZzah64KmOr3jPVX/send?message=Host:$HOSTN%20Type:$PAM_TYPE%20"`
`"Service:$PAM_SERVICE%20User:$PAM_USER%20RHost:$PAM_RHOST"
</code>