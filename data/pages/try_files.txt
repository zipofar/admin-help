===== Try_files директива =====

Директива try_files проверяет существует ли файл или директория согласно uri. Если существует, то открывает ее. Если не существует, то пытается сделать редирект. Если и редирект не отработал, то возвращает код статуса.

Синтаксис в официальной документации выглядит так:
<code>
Syntax: 	
try_files file ... uri;
try_files file ... =code;
</code>

Это значит, что под аргументом file понимается путь до файла в операционной системе, который берется начиная от пути, определенном в директиве root.

Т.е. try_files проверяет, существует ли файл по такому пути, если не существует, то либо прекращает работу, либо переходит к следующему аргументу file, если он есть конечно.


===== Пример 1 =====
Здесь когда вводим в адресную строку браузера http://test1.loc/images, происходит следующее. NGINX проверяет существует ли файл /var/www/test1.loc/foo/img01.jpg и если существует, то передает его клиенту (браузеру), если не существует, то проверяет существует ли файл /var/www/test1.loc/bar/img02.jpg и если существует, то передает его клиенту (браузеру), если не существует, то передает клиенту (браузеру) код ошибки.
<code>
server {
    listen 80;
    server_name test1.loc;
    index index.html;
    root /var/www/test1.loc;
    
    location /images {
        try_files /foo/img01.jpg /bar/img02.jpg;
    }
}
</code>

===== Определение $uri, $args =====

В переменной $uri хранится значение пути до файла. Например из примера выше $uri=/images. Т.е. если в адресной строке набрать http://test1.loc/images/foo/bar/img01.jpg, то $uri будет содержать /images/foo/bar/img01.jpg.

В переменной $args хранятся аргументы. На пример $args будет содержать в себе a=1&b=2 в таком случае http://test1.loc/images?a=1&b=2

Кстати, посмотреть какое значение содержит переменная можно с помощью вот такого метода:
<code>
location /
{
    return 200 $uri; # или любая другая переменная
}
</code>

Для дебаггинга есть еще такая [[https://github.com/openresty/echo-nginx-module#installation|штука]].
===== Пример 2 =====
Здесь когда вводим в адресную строку браузера http://test1.loc/xxx/foo.html, происходит следующее. NGINX проверяет существует ли файл **/var/www/test1.loc/xxx/foo.html** и если существует, то передает его клиенту (браузеру), если не существует, то проверяет существует ли файл **/var/www/test1.loc/bar/default.jpg** и если существует, то передает его клиенту (браузеру), если не существует, то передает клиенту (браузеру) код ошибки.
<code>
server {
    listen 80;
    server_name test1.loc;
    index index.html;
    root /var/www/test1.loc;
    
    location /xxx {
        try_files $uri /bar/default.jpg;
    }
}
</code>
